(globalThis.webpackChunknimus_cards=globalThis.webpackChunknimus_cards||[]).push([[167],{7167:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>E});var n=a(7294),c=a(5977),l=a(3465),r=a.n(l),s=a(5620),i=a(446),o=a(1461),m=a(2291);const d=function({addAttachment:e,errorMessage:t}){const[a,c]=(0,n.useState)(""),[l,r]=(0,n.useState)("image");function s(e){c(e),setTimeout((()=>{c("")}),3200)}function i(){s(`URL does not contain valid ${l} file.`)}return n.createElement("div",{className:"upload-panel"},n.createElement("div",{className:"upload-type-selection"},["image","audio","video"].map(((e,t)=>n.createElement("button",{className:"btn btn-icon-text upload-type-selection-btn"+(l===e?" active":""),onClick:()=>r(e),key:t},n.createElement(o.Z,{name:`${e}-file`}),n.createElement("span",null,e))))),n.createElement("div",{className:"upload-panel-content"},n.createElement("label",{className:"btn upload-panel-import-input-container"},n.createElement("span",null,"Select File"),n.createElement("input",{type:"file",className:"sr-only",onChange:function({target:t}){const[a]=t.files;t.value="",a.type.split("/")[0]!==l?s(`Selected file is not ${"v"===l[0]?"a":"an"} ${l} file.`):e({blob:a,type:l})}})),n.createElement("div",{className:"upload-panel-item-separator"},"OR"),a&&n.createElement("div",{className:"upload-panel-message"},a),n.createElement("form",{onSubmit:function(t){const a=t.target.elements.url.value.trim();if(t.preventDefault(),a){if("image"===l){const t=new Image;t.onload=()=>{e({url:a,type:l})},t.onerror=e=>{i(),console.log(e)},t.src=a}else if("audio"===l){const t=new Audio(a);t.onloadedmetadata=()=>{e({url:a,type:l})},t.onerror=e=>{i(),console.log(e)}}else if("video"===l){const t=document.createElement("video");t.crossOrigin="anonymous",t.onloadedmetadata=()=>{e({url:a,type:l})},t.onerror=e=>{i(),console.log(e)},t.src=a}}else s("Please specify valid url.")},className:"upload-panel-form"},n.createElement("input",{type:"text",name:"url",className:"input upload-panel-form-input",placeholder:"Enter URL..."}),n.createElement("button",{className:"btn upload-panel-form-btn"},"Upload"))),t&&n.createElement("div",{className:"create-side-message"},t))};a(285);const u=n.memo((({attachment:e})=>{const{blob:t,url:a,type:c}=e,l=t?URL.createObjectURL(t):a;return"image"===c?n.createElement("img",{src:l,alt:"",className:"create-side-image"}):"audio"===c?n.createElement("audio",{src:l,className:"create-side-audio",controls:!0}):"video"===c?n.createElement("video",{src:l,className:"create-side-video",crossOrigin:"anonymous",controls:!0}):null}));const p=function({side:e,addAttachment:t,removeAttachment:a,updateAttachmentDescription:c,handleChange:l}){const{text:r,attachment:s}=e,[i,m]=(0,n.useState)(!r&&s?"attachment":"text");function p({target:e}){m(e.value)}return n.createElement("div",{className:"create-card-side"},n.createElement("div",{className:"create-side-toolbar"},n.createElement("ul",{className:"create-side-types"},n.createElement("li",{className:"create-side-type"},n.createElement("label",null,n.createElement("input",{type:"radio",className:"sr-only create-type-radio",value:"text",checked:"text"===i,onChange:p}),n.createElement(o.Z,{name:"text",title:"Text",className:"create-option-type-icon"}))),n.createElement("li",{className:"create-side-type"},n.createElement("label",null,n.createElement("input",{type:"radio",className:"sr-only create-type-radio",value:"attachment",checked:"attachment"===i,onChange:p}),n.createElement(o.Z,{name:"attachment",title:"Attachment",className:"create-option-type-icon"}))))),"text"===i?n.createElement("div",{className:"create-side-content create-front-side-content"},n.createElement("textarea",{className:"input create-side-text-input",value:r,onChange:l}),function(){const{error:t}=e;return t?.attachmentMessage?n.createElement("div",{className:"create-side-message"},t.attachmentMessage):t?.textMessage?n.createElement("div",{className:"create-side-message"},t.textMessage):null}()):n.createElement("div",{className:"create-side-content create-front-side-content"},s?n.createElement(n.Fragment,null,n.createElement("div",{className:"create-side-panel"},n.createElement("button",{type:"button",className:"btn btn-icon create-side-panel-btn",onClick:a,title:"Remove attachment"},n.createElement(o.Z,{name:"remove"})),n.createElement(u,{attachment:s}),e.error?.attachmentMessage&&n.createElement("div",{className:"create-side-attachment-message"},e.error.attachmentMessage)),n.createElement("input",{type:"text",className:"input create-side-attachment-input",placeholder:"Describe attachment",defaultValue:s.description,onChange:c})):n.createElement(d,{addAttachment:t,errorMessage:e.error?.textMessage})))};const v=function({side:e,updateCardBack:t}){const{type:a,textOptions:c,multiOptions:l,exactOptions:r}=e;function i({target:e}){l.layout=e.value,t({multiOptions:l})}function m({target:e}){const{name:a,value:n}=e,c=l.options[a];n!==c.value&&(c.value=n,t({multiOptions:l}))}function d({target:e}){const{name:a,value:n,checked:c}=e;"caseSensitive"===a?r.caseSensitive=c:r.value=n,t({exactOptions:r})}function u(){return n.createElement("textarea",{className:"input create-side-text-input",value:c.value,onChange:a=>function({target:a}){const{value:n}=a;n!==e.value&&(c.value=n,t({textOptions:c}))}(a)})}function p(){return n.createElement(n.Fragment,null,n.createElement("div",{className:"create-multi-layout"},n.createElement("div",{className:"create-multi-layout-title"},"Layout"),n.createElement("div",{onInput:i,className:"create-multi-layout-items"},n.createElement("label",{className:"create-multi-layout-item"},n.createElement("input",{type:"radio",className:"sr-only create-type-radio",name:"multi-select",value:"short",defaultChecked:"short"===l.layout}),n.createElement(o.Z,{name:"grid",className:"create-option-type-icon"})),n.createElement("label",{className:"create-multi-layout-item"},n.createElement("input",{type:"radio",className:"sr-only create-type-radio",name:"multi-select",value:"medium",defaultChecked:"medium"===l.layout}),n.createElement(o.Z,{name:"list-2-col",className:"create-option-type-icon"})),n.createElement("label",{className:"create-multi-layout-item"},n.createElement("input",{type:"radio",className:"sr-only create-type-radio",name:"multi-select",value:"long",defaultChecked:"long"===l.layout}),n.createElement(o.Z,{name:"menu",className:"create-option-type-icon"})))),n.createElement("ul",null,l.options.map((({id:e,value:a},c)=>n.createElement("li",{className:"create-option",key:e},n.createElement("label",null,n.createElement("input",{type:"radio",className:"sr-only radio-input",name:"multi-option",checked:l.correctId===e,onChange:()=>function(e){l.correctId=e,t({multiOptions:l})}(e)}),n.createElement("div",{className:"radio",title:"Mark answer as correct"})),n.createElement("input",{type:"text",className:"input create-option-input",name:c,defaultValue:a,autoComplete:"off",onChange:m}),n.createElement("button",{className:"btn btn-icon",title:"Remove answer",onClick:()=>{return e=c,l.options.splice(e,1),void t({multiOptions:l});var e}},n.createElement(o.Z,{name:"remove"})))))))}return n.createElement("div",{className:"create-card-side"},n.createElement("div",{className:"create-side-toolbar"},n.createElement("ul",{className:"create-side-types",onChange:function({target:e}){t({type:e.value})}},n.createElement("li",{className:"create-side-type"},n.createElement("label",null,n.createElement("input",{type:"radio",className:"sr-only create-type-radio",name:"type-select",value:"text",defaultChecked:"text"===a}),n.createElement(o.Z,{name:"text",title:"Text",className:"create-option-type-icon"}))),n.createElement("li",{className:"create-side-type"},n.createElement("label",null,n.createElement("input",{type:"radio",className:"sr-only create-type-radio",name:"type-select",value:"multi",defaultChecked:"multi"===a}),n.createElement(o.Z,{name:"list-checkbox",title:"Multiple choice",className:"create-option-type-icon"}))),n.createElement("li",{className:"create-side-type"},n.createElement("label",null,n.createElement("input",{type:"radio",className:"sr-only create-type-radio",name:"type-select",value:"exact",defaultChecked:"exact"===a}),n.createElement(o.Z,{name:"text-short",title:"Exact answer",className:"create-option-type-icon"})))),"multi"===a&&n.createElement("button",{className:"btn btn-icon",onClick:function(){l.options.length<8&&(l.options.push({id:(0,s.zO)()}),t({multiOptions:l}))},title:"Add option",disabled:l.options.length>=8},n.createElement(o.Z,{name:"add-list-item"}))),n.createElement("div",{className:"create-side-content"},function(e){return"text"===e?u():"multi"===e?p():"exact"===e?n.createElement("div",{onChange:d},n.createElement("label",{className:"create-exact-input-container"},n.createElement("div",{className:"create-exact-input-title"},"Provide an answer:"),n.createElement("input",{type:"text",className:"input create-exact-input",name:"input",autoComplete:"off",defaultValue:r.value})),n.createElement("label",{className:"checkbox-container create-exact-checkbox-container"},n.createElement("input",{type:"checkbox",className:"sr-only checkbox-input",name:"caseSensitive",defaultChecked:r.caseSensitive}),n.createElement("div",{className:"checkbox"},n.createElement("div",{className:"checkbox-tick"})),n.createElement("span",{className:"checkbox-label"},"Case sensitive"))):null}(a),e.error?.message&&n.createElement("div",{className:"create-side-message"},e.error.message)))};function f({value:e,handleChange:t}){return n.createElement("div",{className:"create-card-notes-container"},n.createElement("textarea",{className:"input create-card-notes-input",placeholder:"Notes...",value:e,onChange:e=>t(e,"notes","value")}))}const E=function(){const e=(0,c.k6)(),t=(0,c.UO)(),[a,l]=(0,n.useState)(null),[d,u]=(0,n.useState)([]),{location:E}=e;let h=0;function b(){return{id:(0,s.zO)(),front:{text:""},back:{type:"text",textOptions:{value:""},multiOptions:{correctId:"",layout:"short",options:[{id:(0,s.zO)()},{id:(0,s.zO)()}]},exactOptions:{caseSensitive:!1,value:""}},notes:{value:""},score:{streak:0,right:0,wrong:0,total:0}}}function g(e){return e.map((e=>{const{back:t}=b();return e.back={...t,...e.back,[`${e.back.type}Options`]:e.back.typeOptions},delete e.back.typeOptions,e}))}function y(e,t){const n=e+t,c=a.cards;[c[e],c[n]]=[c[n],c[e]],l({...a})}function N({target:e}){const{name:t,value:n}=e;a[t]=n,"title"===t&&a.missingTitle&&delete a.missingTitle,l({...a})}function k(e){return e.attachment?!!e.attachment.description:!!e.text}function x(e){return{validOptionCount:e.options.reduce(((e,{value:t})=>(t&&(e+=1),e)),0),correctId:e.correctId}}function C(e){if("text"===e.type)return e.textOptions.value.length>0;if("exact"===e.type)return e.exactOptions.value.length>0;const{validOptionCount:t,correctId:a}=x(e.multiOptions);return t>1&&a}function O(t){a.title||(a.missingTitle=!0);const n=function(e){let t=0;for(const a of e){let e=0;if(a.valid=!1,a.invalid=!1,k(a.front))e+=1,delete a.front.error;else{a.front.error=a.front.error||{};const{text:e,attachment:t,error:n}=a.front;t&&!t.description?n.attachmentMessage="Please provide attachment description.":e||(n.textMessage="Please fill in the text field or provide an attachment.")}if(C(a.back))e+=1,delete a.back.error;else{a.back.error=a.back.error||{};const{type:e,textOptions:t,exactOptions:n,multiOptions:c,error:l}=a.back;if("text"!==e||t.value)if("exact"!==e||n.value){if("multi"===e){const{validOptionCount:e,correctId:t}=x(c);e<2?l.message="Please fill in at least 2 options.":t||(l.message="Please select correct option.")}}else l.message="Please provide an answer.";else l.message="Please fill in the text field."}2===e?(t+=1,a.valid=!0):a.invalid=!0}return a.globalMessage=t<2?"Please fill in at least 2 cards.":"",t===e.length}(a.cards);if(a.title&&n)if(a.cards=a.cards.map((e=>{const t={type:e.back.type,typeOptions:e.back[`${e.back.type}Options`]};return e.modified&&(delete e.score,delete e.level,delete e.nextReview),delete e.modified,delete e.invalid,delete e.valid,"multi"===t.type&&(t.typeOptions.options=e.back.multiOptions.options.filter((({value:e})=>e))),e.back=t,e})),"preview"===t)e.push({pathname:`/decks/${a.id}/preview`,state:a});else{const t=Date.now();delete a.type,delete a.selectedCardIndex,a.createdAt?a.modifiedAt=t:a.createdAt=t,e.push("/decks"),(0,i.C2)(a)}else l({...a})}if((0,n.useEffect)((()=>{const{id:e}=t;if(E.state){const e=E.state;e.cards=g(e.cards),l(e),(0,s.Dk)("edit"===e.type?`Editing ${e.title}`:"Create a new deck")}else"/decks/create"===E.pathname?(l({id:(0,s.zO)(),type:"create",title:"",description:"",selectedCardIndex:0,cards:[b(),b()]}),(0,s.Dk)("Create a new deck")):e&&(0,i.VC)(e).then((e=>{e?(e.type="edit",e.makingEdit=!0,e.selectedCardIndex=0,e.cards=g(e.cards),l(e),(0,s.Dk)(`Editing ${e.title}`)):l({error:!0})}))}),[]),(0,n.useEffect)((()=>(clearTimeout(h),d.length>0&&(h=setTimeout((()=>{u([])}),8e3)),()=>{clearTimeout(h)})),[d.length]),!a)return null;if(a.error)return n.createElement(m.Z,null);const I=a.selectedCardIndex,w=a.cards.length,A=a.cards[I];return n.createElement(n.Fragment,null,n.createElement("label",{className:"create-field"},n.createElement("div",{className:"create-field-title"},"Title"),n.createElement("input",{className:"input create-field-input",name:"title",value:a.title,onChange:N}),a.missingTitle&&n.createElement("div",{className:"create-field-input-message"},"Please provide title for your deck.")),n.createElement("label",{className:"create-field"},n.createElement("div",{className:"create-field-title"},"Description"),n.createElement("input",{className:"input create-field-input",name:"description",value:a.description,onChange:N})),n.createElement("ul",{className:"create-card-select"},a.cards.map(((e,t)=>n.createElement("li",{className:"create-card-select-item",key:t},n.createElement("button",{className:`btn btn-text create-card-select-btn${t===a.selectedCardIndex?" active":""}${e.invalid?" invalid":""}${e.valid?" valid":""}`,onClick:()=>function(e){e!==a.selectedCardIndex&&l({...a,selectedCardIndex:e})}(t)},t+1)))),n.createElement("li",{className:"create-card-select-item"},n.createElement("button",{onClick:function(){const e=a.cards[a.cards.length-1],t=b();t.back.type=e.back.type,"multi"===t.back.type?t.back.multiOptions.layout=e.back.multiOptions.layout:"exact"===t.back.type&&(t.back.exactOptions.caseSensitive=e.back.exactOptions.caseSensitive),l({...a,cards:[...a.cards,t]})},className:"btn btn-icon create-card-select-btn",title:"Add Card"},n.createElement(o.Z,{name:"plus"})))),n.createElement("div",{className:"create-card"},n.createElement("div",{className:"create-card-header"},n.createElement("div",{className:"create-card-index-container"},n.createElement("button",{className:"btn btn-icon create-card-header-item",onClick:()=>y(I,-1),title:"Swap with the left card",disabled:0===I},n.createElement(o.Z,{name:"chevron-left"})),n.createElement("div",{className:"create-card-index"},I+1),n.createElement("button",{className:"btn btn-icon create-card-header-item",onClick:()=>y(I,1),title:"Swap with the right card",disabled:I===w-1},n.createElement(o.Z,{name:"chevron-right"}))),n.createElement("button",{className:"btn btn-icon",title:"Clone card",onClick:()=>function(e){const t=r()(a.cards[e]);t.id=(0,s.zO)(),a.selectedCardIndex=e,a.cards.splice(e,0,t),l({...a})}(I)},n.createElement(o.Z,{name:"clone"})),w>1&&n.createElement("button",{className:"btn btn-icon create-card-remove-card-btn",title:"Remove card",onClick:()=>function(e){const t=a.cards[e];(k(t.front)||C(t.back)||t.notes.value)&&u([...d,t]),a.selectedCardIndex=e>0?e-1:0,a.cards.splice(e,1),l({...a})}(I)},n.createElement(o.Z,{name:"remove"}))),n.createElement("div",{className:"create-card-main",key:A.id},n.createElement(p,{side:A.front,addAttachment:function(e){const t=a.cards[a.selectedCardIndex];t.modified=!0,t.front.attachment=e,delete t.front.error,l({...a})},removeAttachment:function(){const e=a.cards[a.selectedCardIndex];e.modified=!0,delete e.front.attachment,delete e.front.error,l({...a})},updateAttachmentDescription:function({target:e}){const t=a.cards[a.selectedCardIndex];t.modified=!0,t.front.attachment.description=e.value,t.front.error?.attachmentMessage&&delete t.front.error,l({...a})},handleChange:function({target:e}){const{value:t}=e,n=a.cards[a.selectedCardIndex];t!==n.front.text&&(n.front.text=t,n.modified=!0,n.front.error?.textMessage&&delete n.front.error.textMessage,l({...a}))}}),n.createElement(v,{side:A.back,updateCardBack:function(e){const t=a.cards[a.selectedCardIndex];t.modified=!0,t.back={...t.back,...e},delete t.back.error,l({...a})}})),n.createElement(f,{value:A.notes.value,handleChange:function({target:e}){const{value:t}=e,n=a.cards[a.selectedCardIndex];t!==n.notes.value&&(n.notes.value=t,l({...a}))}})),d.length>0&&n.createElement("div",{className:"create-undo-dialog"},n.createElement("span",null,"Removed ",d.length," card",d.length>1?"s":""),n.createElement("button",{className:"btn btn-text create-dialog-undo-btn",onClick:function(){u([]),l({...a,cards:a.cards.concat(d)})}},"UNDO")),n.createElement("div",{className:"create-footer"},a.globalMessage&&n.createElement("span",{className:"create-message"},a.globalMessage),n.createElement("button",{className:"btn create-footer-btn",onClick:function(){O("preview")}},"Preview"),n.createElement("button",{className:"btn create-footer-btn",onClick:O},a.makingEdit?"Update":"Create")))}},446:(e,t,a)=>{"use strict";a.d(t,{GT:()=>c,VC:()=>l,C2:()=>r,$P:()=>s});const n=new(a(9642).Z)("nimus-cards");function c(){return n.decks.toArray().then(i).catch((e=>{console.log(e)}))}function l(e){return n.decks.get(e)}function r(e){n.decks.put(e).catch((e=>{console.log(e)}))}function s(e){n.decks.delete(e).catch((e=>{console.log(e)}))}function i(e){return e.sort(((e,t)=>e.createdAt<t.createdAt?1:e.createdAt>t.createdAt?-1:0))}n.version(1).stores({decks:"id"})}}]);